import{_ as y,o as l,c as u,f as d,g as U,b as e,v as _,i as p,p as k,h as w,j as a,F as b,d as x,t as f,k as g,r as F,e as S,a as I}from"./index-BkKvcv0a.js";const V={props:{user:{type:Object,required:!0}}},o=t=>(k("data-v-c662529c"),t=t(),w(),t),C=o(()=>e("label",{for:"name"},"姓名:",-1)),E=o(()=>e("br",null,null,-1)),L=o(()=>e("br",null,null,-1)),q=o(()=>e("label",{for:"username"},"帳號:",-1)),D=o(()=>e("br",null,null,-1)),N=o(()=>e("br",null,null,-1)),T=o(()=>e("label",{for:"password"},"密碼:",-1)),A=o(()=>e("br",null,null,-1)),B=o(()=>e("br",null,null,-1)),O=o(()=>e("label",null,"功能限制:",-1)),j=o(()=>e("br",null,null,-1)),R=o(()=>e("label",{for:"checkbox1"},"開關控制",-1)),$=o(()=>e("br",null,null,-1)),M=o(()=>e("label",{for:"checkbox2"},"時間控制",-1)),z=o(()=>e("br",null,null,-1)),G=o(()=>e("label",{for:"checkbox3"},"權限控制",-1)),H=o(()=>e("br",null,null,-1)),J=o(()=>e("br",null,null,-1)),K=o(()=>e("input",{type:"submit",value:"提交"},null,-1)),Q=o(()=>e("input",{type:"reset",value:"刪除"},null,-1));function W(t,n,s,v,c,m){return l(),u("form",{onSubmit:n[6]||(n[6]=p(i=>t.$emit("submit"),["prevent"])),onReset:n[7]||(n[7]=p(i=>t.$emit("reset","new"),["prevent"]))},[C,d(e("input",{type:"text","onUpdate:modelValue":n[0]||(n[0]=i=>s.user.name=i),required:""},null,512),[[U,s.user.name]]),E,L,q,d(e("input",{type:"text","onUpdate:modelValue":n[1]||(n[1]=i=>s.user.username=i),required:""},null,512),[[U,s.user.username]]),D,N,T,d(e("input",{type:"text","onUpdate:modelValue":n[2]||(n[2]=i=>s.user.password=i),required:""},null,512),[[U,s.user.password]]),A,B,O,j,d(e("input",{type:"checkbox",id:"checkbox1","onUpdate:modelValue":n[3]||(n[3]=i=>s.user.function1=i)},null,512),[[_,s.user.function1]]),R,$,d(e("input",{type:"checkbox",id:"checkbox2","onUpdate:modelValue":n[4]||(n[4]=i=>s.user.function2=i)},null,512),[[_,s.user.function2]]),M,z,d(e("input",{type:"checkbox",id:"checkbox3","onUpdate:modelValue":n[5]||(n[5]=i=>s.user.function3=i)},null,512),[[_,s.user.function3]]),G,H,J,K,Q],32)}const X=y(V,[["render",W],["__scopeId","data-v-c662529c"]]),Y={props:{users:{type:Array,required:!0},hasPermission:{type:Boolean,required:!0},editingUser:{type:Object,required:!0},editingIndex:{type:Number,required:!1}},methods:{hidePassword(t){return"*".repeat(t.length)},formatUserFunctions(t){return["function1","function2","function3"].filter(n=>t[n]).map(n=>this.getFunctionLabel(n)).join(" ")},getFunctionLabel(t){switch(t){case"function1":return"開關控制";case"function2":return"時間控制";case"function3":return"權限控制";default:return""}}}},P=t=>(k("data-v-8dcc1fd7"),t=t(),w(),t),Z=P(()=>e("th",null,"姓名",-1)),ee={key:0},te={key:1},ne={key:2},se=P(()=>e("th",null,"設定",-1)),ie={key:0},oe={key:1},re={key:2},le=["onClick","disabled"],ue=["onClick","disabled"],de={key:0},ae={key:1},ce={key:2},me=["onClick"];function he(t,n,s,v,c,m){return l(),u("table",null,[e("thead",null,[e("tr",null,[Z,s.hasPermission?(l(),u("th",ee,"帳號")):a("",!0),s.hasPermission?(l(),u("th",te,"密碼")):a("",!0),s.hasPermission?(l(),u("th",ne,"功能限制")):a("",!0),se])]),e("tbody",null,[(l(!0),u(b,null,x(s.users,(i,h)=>(l(),u("tr",{key:h},[s.editingIndex!==h?(l(),u(b,{key:0},[e("td",null,f(i.name),1),s.hasPermission?(l(),u("td",ie,f(i.username),1)):a("",!0),s.hasPermission?(l(),u("td",oe,f(m.hidePassword(i.password)),1)):a("",!0),s.hasPermission?(l(),u("td",re,f(m.formatUserFunctions(i)),1)):a("",!0),e("td",null,[e("button",{onClick:r=>t.$emit("edit",h),disabled:!s.hasPermission},"編輯",8,le),e("button",{onClick:r=>t.$emit("delete",h),disabled:!s.hasPermission},"刪除",8,ue)])],64)):(l(),u(b,{key:1},[e("td",null,[d(e("input",{type:"text","onUpdate:modelValue":n[0]||(n[0]=r=>s.editingUser.name=r),readonly:"",class:"readonly-input"},null,512),[[U,s.editingUser.name]])]),s.hasPermission?(l(),u("td",de,[d(e("input",{type:"text","onUpdate:modelValue":n[1]||(n[1]=r=>s.editingUser.username=r),readonly:"",class:"readonly-input"},null,512),[[U,s.editingUser.username]])])):a("",!0),s.hasPermission?(l(),u("td",ae,[d(e("input",{type:"password","onUpdate:modelValue":n[2]||(n[2]=r=>s.editingUser.password=r)},null,512),[[U,s.editingUser.password]])])):a("",!0),s.hasPermission?(l(),u("td",ce,[d(e("input",{type:"checkbox","onUpdate:modelValue":n[3]||(n[3]=r=>s.editingUser.function1=r)},null,512),[[_,s.editingUser.function1]]),g("開關控制 "),d(e("input",{type:"checkbox","onUpdate:modelValue":n[4]||(n[4]=r=>s.editingUser.function2=r)},null,512),[[_,s.editingUser.function2]]),g("時間控制 "),d(e("input",{type:"checkbox","onUpdate:modelValue":n[5]||(n[5]=r=>s.editingUser.function3=r)},null,512),[[_,s.editingUser.function3]]),g("權限控制 ")])):a("",!0),e("td",null,[e("button",{onClick:r=>t.$emit("save",h)},"保存",8,me),e("button",{onClick:n[6]||(n[6]=r=>t.$emit("cancel-edit"))},"取消")])],64))]))),128))])])}const Ue=y(Y,[["render",he],["__scopeId","data-v-8dcc1fd7"]]),_e={components:{UserForm:X,UserList:Ue},data(){return{showForm:!1,newUser:this.getEmptyUser(),editingUser:this.getEmptyUser(),userList:[],editingIndex:null,hasPermission:!1,userName:"",ipAddress:"192.168.50.1"}},methods:{getEmptyUser(){return{name:"",username:"",password:"",function1:!1,function2:!1,function3:!1}},resetUserForm(t="new"){t==="new"?this.newUser=this.getEmptyUser():(this.editingUser=this.getEmptyUser(),this.editingIndex=null)},handleSubmit(t){const n=t.id?"/updatedata":"/insertdata";return fetch(n,{method:"POST",body:new URLSearchParams(t)})},submitForm(){if(this.isDuplicateUsername(this.newUser.username)){alert("已存在相同的使用者名稱，請選擇不同的帳號名稱。");return}this.handleSubmit(this.newUser).then(t=>{t.ok?(alert(`用戶已成功${this.newUser.id?"更新":"新增"}`),this.logAction("帳號權限",this.userName,this.getTaiwanISOTime(),`${this.newUser.id?"修改":"新增"}用戶 ${this.newUser.username}`,this.ipAddress),this.resetUserForm("new"),this.loadUserData(),this.showForm=!1):console.error("提交表單時出現錯誤")}).catch(t=>console.error("發生錯誤：",t))},saveUser(){this.handleSubmit(this.editingUser).then(t=>{t.ok?(alert("用戶已成功更新"),this.logAction("帳號權限",this.userName,this.getTaiwanISOTime(),`修改用戶 ${this.editingUser.username}`,this.ipAddress),this.resetUserForm("edit"),this.loadUserData()):console.error("更新用戶時出現錯誤")}).catch(t=>console.error("發生錯誤：",t))},isDuplicateUsername(t){return this.userList.some(n=>n.username===t&&n.id!==this.newUser.id)}}},fe=t=>(k("data-v-04e943ee"),t=t(),w(),t),be={class:"content clearfix"},ge={class:"left-column"},ye={class:"right-column"},ke=fe(()=>e("h2",null,"使用者清單",-1));function we(t,n,s,v,c,m){const i=F("UserForm"),h=F("UserList");return l(),u("div",be,[e("div",ge,[e("button",{onClick:n[0]||(n[0]=(...r)=>t.toggleForm&&t.toggleForm(...r)),class:"button1"},"新增使用者"),c.showForm?(l(),S(i,{key:0,user:c.newUser,onSubmit:m.submitForm,onReset:m.resetUserForm},null,8,["user","onSubmit","onReset"])):a("",!0)]),e("div",ye,[ke,I(h,{users:c.userList,hasPermission:c.hasPermission,editingUser:c.editingUser,editingIndex:c.editingIndex,onEdit:t.editUser,onDelete:t.deleteUser,onSave:m.saveUser,onCancelEdit:t.cancelEdit},null,8,["users","hasPermission","editingUser","editingIndex","onEdit","onDelete","onSave","onCancelEdit"])])])}const pe=y(_e,[["render",we],["__scopeId","data-v-04e943ee"]]);export{pe as default};
