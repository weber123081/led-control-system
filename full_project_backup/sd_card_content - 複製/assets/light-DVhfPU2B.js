import{_ as d,o as a,c as l,b as c,f as m,v as p,t as f,r as w,F as g,d as _,e as y}from"./index-BkKvcv0a.js";const S={props:{url:{type:String,required:!0},label:{type:String,required:!0},hasPermission:{type:Boolean,required:!0}},data(){return{switchState:!1}},methods:{async toggleSwitch(){if(this.hasPermission){const t=this.switchState?"on":"off",o=`http://hota-iot.local/gpio?pin=${this.url.match(/\d+/)[0]}&state=${t}`;try{if(!(await fetch(o)).ok)throw new Error("网络响应异常");this.$emit("logAction",`${this.label}${t}`)}catch(r){console.error(`错误：${r}`)}}else alert("您没有权限执行此操作！")},async fetchStatus(){try{const t=await fetch(this.url);if(!t.ok)throw new Error("网络响应异常");const e=await t.json();this.switchState=e.state==="on"}catch(t){console.error(`错误：${t}`)}}},mounted(){this.fetchStatus(),this.$intervalId=setInterval(()=>this.fetchStatus(),1e3)},beforeUnmount(){clearInterval(this.$intervalId)}},b={class:"switch-container"},$=["disabled"],k={class:"status"};function P(t,e,o,r,s,n){return a(),l("div",b,[c("label",null,[m(c("input",{type:"checkbox",class:"l","onUpdate:modelValue":e[0]||(e[0]=i=>s.switchState=i),onChange:e[1]||(e[1]=(...i)=>n.toggleSwitch&&n.toggleSwitch(...i)),disabled:!o.hasPermission},null,40,$),[[p,s.switchState]])]),c("span",k,f(s.switchState?`${o.label}走道On`:`${o.label}走道Off`),1)])}const v=d(S,[["render",P],["__scopeId","data-v-abc249ff"]]),A={components:{SwitchComponent:v},data(){return{urls:["/gpio3","/gpio5","/gpio7"],labels:["第一排","第二排","第三排"],hasPermission:!1,userName:"",ipAddress:"192.168.50.1"}},methods:{async checkPermission(){try{const t=await fetch("/function1");if(!t.ok)throw new Error("网络响应异常");const e=await t.json();if(this.hasPermission=e.function1===1,!this.hasPermission)throw alert("您没有权限执行此操作！"),new Error("没有权限")}catch(t){console.error(`错误：${t}`)}},async fetchUserInfo(){try{const t=await fetch("/get_user_info");if(!t.ok)throw new Error("网络响应异常");const e=await t.json();this.userName=e.name}catch(t){console.error(`获取用户信息错误：${t}`)}},handleLogAction(t){this.logAction("电源开关",this.userName,this.getTaiwanISOTime(),t,this.ipAddress)},async logAction(t,e,o,r,s){try{if(!(await fetch("/logs",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({function:t,username:e,date:o,action:r,ip:s})})).ok)throw new Error("记录失败");console.log("记录成功")}catch(n){console.error(`记录错误：${n}`)}},getTaiwanISOTime(){const t=new Date,e={timeZone:"Asia/Taipei",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1},[o,r]=t.toLocaleString("en-GB",e).split(", "),[s,n,i]=o.split("/");return`${i}-${n}-${s},${r}`}},async mounted(){await this.checkPermission(),await this.fetchUserInfo()}},I={class:"led"};function T(t,e,o,r,s,n){const i=w("SwitchComponent");return a(),l("div",I,[(a(!0),l(g,null,_(s.urls,(u,h)=>(a(),y(i,{key:h,url:u,label:s.labels[h],hasPermission:s.hasPermission,onLogAction:n.handleLogAction},null,8,["url","label","hasPermission","onLogAction"]))),128))])}const E=d(A,[["render",T],["__scopeId","data-v-f1c2efb2"]]);export{E as default};
